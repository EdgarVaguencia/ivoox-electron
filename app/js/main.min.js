"use strict";var ivoox=require("node-ivoox"),_=require("underscore"),Backbone=require("backbone"),jQuery=require("jquery"),ivooxNode={Models:{},Collections:{},Views:{},Router:{}};window.ivooxNode=ivooxNode,ivooxNode.Models.Audio=Backbone.Model.extend({}),ivooxNode.Collections.Audios=Backbone.Collection.extend({model:ivooxNode.Models.Audio}),ivooxNode.Views.Audio=Backbone.View.extend({className:"audio-view",template:_.template('<div class="audio-cover"><div class="cover-play"></div><img src="<%= podcast_cover %>" alt="<%= name %>" /></div><div class="audio-info"><span class="title"><%= name %></span></div>'),events:{"click .cover-play":"play"},render:function(){var e=this.model.toJSON(),o=this.template(e);return this.$el.html(o),this},play:function(){return ivooxNode.app.player.model.set(this.model.toJSON()),!1}}),ivooxNode.Views.List=Backbone.View.extend({el:jQuery(".page-content"),initialize:function(){this.listenTo(this.collection,"add",this.add,this)},add:function(e){var o=new ivooxNode.Views.Audio({model:e});this.$el.append(o.render().el)}}),ivooxNode.Views.Player=Backbone.View.extend({el:jQuery(".player"),events:{"click .play":"playSong"},_isPlaying:!1,template:_.template('<picture><img src="<%= podcast_cover %>" /></picture><div class="info"><span class="title"><%= name %></span><span><%= author %></span></div><audio src="<%= file %>"></audio>'),initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON();this.$el.find(".current-track").html(this.template(e)),this.audio=this.$el.find("audio")[0],this.playSong()},playSong:function(){this._isPlaying?this.pauseSong():(this.audio.play(),this._isPlaying=!0,this.$el.find(".play").removeClass("icon-play").addClass("icon-pause"))},pauseSong:function(){this.audio.pause(),this._isPlaying=!1,this.$el.find(".play").removeClass("icon-pause").addClass("icon-play")}}),ivooxNode.Router=Backbone.Router.extend({routes:{"":"index"},initialize:function(){this.audios=new ivooxNode.Collections.Audios,this.playlist=new ivooxNode.Views.List({collection:this.audios}),this.player=new ivooxNode.Views.Player({model:new ivooxNode.Models.Audio}),Backbone.history.start()},index:function(){this.fetchAudios()},fetchAudios:function(){var e=this;ivoox.audios().then(function(o){jQuery.each(o,function(o,i){e.addAudio(i)})})["catch"](function(e){console.error(e)})},addAudio:function(e){this.audios.add(new ivooxNode.Models.Audio({name:e.title,author:e.author,podcast_cover:e.imgMain,file:e.file}))}}),jQuery(function(){ivooxNode.app=new ivooxNode.Router});